<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Viktor Sirmer - Blogini</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<header>
  <div class="header-content">
    <div class="logo">
      <h1>Viktor Sirmer</h1>
      <p>Ohjelmist√∂kehitt√§j√§<br>Blogini</p>
    </div>
    <nav>
      <a href="index.html" class="nav-btn">Etusivu</a>
      <a href="koulutus.html" class="nav-btn">Koulutus</a>
      <a href="taidot.html" class="nav-btn">Taidot</a>
      <a href="kokemus.html" class="nav-btn">Kokemus</a>
      <a href="yhteystiedot.html" class="nav-btn">Yhteystiedot</a>
      <a href="blog.html" class="nav-btn">Blogini</a>
      <a href="login.html" class="nav-btn">Kirjaudu</a>
      <a href="projektit.html" class="nav-btn">Projektit</a>
    </nav>
  </div>
</header>

<main>
  <div id="newPostSection" class="new-post" style="display:none;">
    <h2>üìù Lis√§√§ uusi artikkeli</h2>
    <form id="postForm">
      <div class="form-group">
        <label for="postTitle">Otsikko</label>
        <input type="text" id="postTitle" placeholder="Kirjoita otsikko..." required>
      </div>

      <div class="form-group">
        <label for="postContent">Sis√§lt√∂</label>
        <textarea id="postContent" placeholder="Kirjoita artikkeli t√§nne..." required></textarea>
      </div>

      <button type="button" id="addPostBtn">Julkaise</button>
    </form>
  </div>

  <section id="posts"></section>
</main>

<script>
/*  
  üîπ JSONBin ‚Äì –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –æ–Ω–ª–∞–π–Ω-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ JSON.
  –ú—ã –±—É–¥–µ–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–µ–º—É –∫–∞–∫ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
  üîπ –í BIN_ID ‚Äì —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–≤–æ–µ–≥–æ ‚Äú–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞‚Äù.
  üîπ –ï—Å–ª–∏ —É —Ç–µ–±—è –µ—â—ë –Ω–µ—Ç BIN ‚Äì —è –ø–æ–∫–∞–∂—É –Ω–∏–∂–µ, –∫–∞–∫ –µ–≥–æ —Å–æ–∑–¥–∞—Ç—å.
*/
const BIN_ID = "blog-posts"; // –º–æ–∂–µ—à—å –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ª—é–±–æ–µ –∏–º—è
const BASE_URL = `https://api.jsonbin.io/v3/b/690ccea4ae596e708f48d448`;
const API_KEY = "$2a$10$8KXokHpWeAabuTiT/VvWM.fuGydWjyOMuvVIwn409JvYK3DGhaCjq"; // –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º (–∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø)

/*  get function */
async function loadPosts() {
  try {
    const res = await fetch(BASE_URL + "/latest");
    const data = await res.json();
    const posts = data.record || [];

    const postsContainer = document.getElementById("posts");
    postsContainer.innerHTML = posts.map(p => `
      <article class="blog-post">
        <h2>${p.title}</h2>
        <p>${p.content}</p>
        <small>${p.date}</small>
      </article>
    `).join("");
  } catch (e) {
    console.log("Ei viel√§ postauksia tai virhe ladattaessa:", e);
  }
}

/*  Add new post */
async function addPost() {
  const title = document.getElementById("postTitle").value;
  const content = document.getElementById("postContent").value;
  if (!title || !content) return alert("T√§yt√§ molemmat kent√§t!");

  const newPost = {
    title,
    content,
    date: new Date().toLocaleString()
  };

  // Get old posts
  let oldPosts = [];
  try {
    const res = await fetch(BASE_URL + "/latest");
    const data = await res.json();
    oldPosts = data.record || [];
  } catch {}

  // new post as first
  const newPosts = [newPost, ...oldPosts];

  // save to JSONbin
  const save = await fetch(BASE_URL, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "X-Master-Key": API_KEY
    },
    body: JSON.stringify(newPosts)
  });

  if (save.ok) {
    alert("Onnistui!");
    document.getElementById("postTitle").value = "";
    document.getElementById("postContent").value = "";
    loadPosts();
  } else {
    alert("Virhe tallennuksessa.");
  }
}

/*  listener button */
document.getElementById("addPostBtn").addEventListener("click", addPost);

/*  Show form */
if (localStorage.getItem("loggedIn") === "true") {
  document.getElementById("newPostSection").style.display = "block";
}

/* Load posts on open*/
loadPosts();
</script>

</body>
</html>
