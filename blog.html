<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Viktor Sirmer - Blogini</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<script src="header.js" defer></script>

<main>
  <div id="newPostSection" class="new-post" style="display:none;">
    <h2>üìù Lis√§√§ uusi artikkeli</h2>
    <form id="postForm">
      <div class="form-group">
        <label for="postTitle">Otsikko</label>
        <input type="text" id="postTitle" placeholder="Kirjoita otsikko..." required>
      </div>

      <div class="form-group">
        <label for="postContent">Sis√§lt√∂</label>
        <textarea id="postContent" placeholder="Kirjoita artikkeli t√§nne..." required></textarea>
      </div>

      <button type="button" id="addPostBtn">Julkaise</button>
    </form>
  </div>

  <section id="posts"></section>
</main>

<script>
/*  
  üîπ JSONBin ‚Äì free online storage JSON.
  we use it as our simple database for blog posts.
  üîπ –í BIN_ID ‚Äì unique container id 
*/
const BIN_ID = "690cd104d0ea881f40d81d3f";
const BASE_URL = `https://api.jsonbin.io/v3/b/690cd104d0ea881f40d81d3f`;
const API_KEY = ""; // Your JSONBin API key here

/*   function Post load from database (GET) */
async function loadPosts() {
  try {
    const res = await fetch(BASE_URL + "/latest");
    const data = await res.json();
    const posts = data.record || [];

    const postsContainer = document.getElementById("posts");
    postsContainer.innerHTML = posts.map(p => `
      <article class="blog-post">
        <h2>${p.title}</h2>
        <p>${p.content}</p>
        <small>${p.date}</small>
      </article>
    `).join("");
  } catch (e) {
    console.log("Ei viel√§ postauksia tai virhe ladattaessa:", e);
  }
}

/*  Adding new post */
async function addPost() {
  const title = document.getElementById("postTitle").value;
  const content = document.getElementById("postContent").value;
  if (!title || !content) return alert("T√§yt√§ molemmat kent√§t!");

  const newPost = {
    title,
    content,
    date: new Date().toLocaleString()
  };

  // Get old posts via /latest
  let oldPosts = [];
  try {
    const res = await fetch(BASE_URL + "/latest");
    const data = await res.json();
    oldPosts = data.record || [];
  } catch {}

  // Add new post to the beginning
  const newPosts = [newPost, ...oldPosts];

  // Save back to JSONBin via PUT
  const save = await fetch(BASE_URL, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "X-Master-Key": API_KEY
    },
    body: JSON.stringify(newPosts)
  });

  if (save.ok) {
    alert("Posti julkaistu!");
    document.getElementById("postTitle").value = "";
    document.getElementById("postContent").value = "";
    loadPosts();
  } else {
    alert("Virhe tallennuksessa.");
  }
}

/*  Listener for add post button */
document.getElementById("addPostBtn").addEventListener("click", addPost);

/*  Check for logged in and show form */
if (localStorage.getItem("loggedIn") === "true") {
  document.getElementById("newPostSection").style.display = "block";
}

/* Load posts*/
loadPosts();
</script>
    <footer>
        <p>&copy; 2025 Viktor Sirmer</p>
    </footer>
</body>
</html>